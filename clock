#!/usr/bin/env python
from clock_framework import logger
from clock_framework import report
from clock_framework import options

def add_log(arg):
    log = logger.ClockLogger()
    log.read_file(arg.options.file)
    if arg.options.current:
        log.edit_current(' '.join(arg.arguments))
    elif arg.options.command == 'stop':
        log.add(arg.options.at, '[Stop]')
    else:
        log.add(arg.options.at, ' '.join(arg.arguments))

    log.write_file(arg.options.file)

# Start script
arg = options.ClockArguments()
arg.parse()

if arg.options.command in ('add', 'stop'):
    add_log(arg)
    exit()

reader = logger.ClockReader()
reader.read_file(arg.options.file)
collection = reader.parse()
for f in arg.get_filters():
    collection = collection.filter(f)

if arg.options.details:
    all = report.DetailsReport(collection)
    all.print_report()
    exit()

cat = report.CategoriesReport(collection, len(arg.arguments))
cat.print_report()

time_report = report.TotalTimeReport(collection, arg.get_target_time())
time_report.print_report()
